@import 'functions';
@import 'theme';
@import 'defaultTheme';

@function palette($key) {
  @return map-get($palette-colors, $key);
}

//============================================================
// Colors here must reference colors in the theme's palette with
//  palette('key'), without assuming anything about their value
//  except sufficient contrast between foreground and background.
// Includes some variables that aren't strictly colors.
//============================================================

// =Contrast
//============================================================
// [-1, 1]
// > 0: dark on light
// < 0: light on dark
$mainContrast: percToNum(contrast(palette('fgMain'), palette('bgMain')))!default;
$altContrast:  percToNum(contrast(palette('fgAlt'), palette('bgAlt')))!default;

$strongestContrast: max(abs($mainContrast), abs($altContrast))!default;
$weakerContrast:    min(abs($mainContrast), abs($altContrast))!default;

// [-1, 1]
// > 0: saturated on dull
// < 0: dull on saturated
$mainSaturationContrast: percToNum(contrast-saturation(palette('fgMain'), palette('bgMain')))!default;
$altSaturationContrast:  percToNum(contrast-saturation(palette('fgAlt'), palette('bgAlt')))!default;

$strongestSaturationContrast:
  max(abs($mainSaturationContrast), abs($altSaturationContrast))!default;
$weakerSaturationContrast:
  min(abs($mainSaturationContrast), abs($altSaturationContrast))!default;

$fontColorContrast: 0.5 * $mainContrast!default;

//=============================================================
$linkColor:           mix(palette('fgMain'), palette('accentA'))!default;
$linkHoverColor:      take-color($linkColor, palette('accentB'))!default;


$minorHeaderBgColor:  if($vibrant,
  palette('accentA'),
  intensify(palette('bgAlt'), palette('fgMain'), 10))!default;
$minorHeaderColor:    intense-lightness($minorHeaderBgColor, $weight: 60%)!default;  
$minorHeaderBold:     550!default;

// Shadows
//============================================================
$dropShadows: minimal!default;
$shadows: get-drop-shadows-pref($dropShadows);
$shadowsBaseColor:    intensify-lightness(palette('bgMain'), palette('fgMain'))!default;
$shadowsAlpha:        0.15!default;
$shadowsColor:        rgba($shadowsBaseColor, $shadowsAlpha)!default;
$shadowsRadius:       0.4em!default;
@mixin tooltipShadows() {
  box-shadow: 0 0 #{$shadowsRadius * 5} rgba($shadowsBaseColor, $shadowsAlpha * 1.5 * $shadows);
};

//=============================================================
$borderColorMain:     mix(palette('bgMain'), palette('fgMain'), 80%);
@mixin mainColors {
  background-color:   palette('bgMain');
  color:              palette('fgMain');
  border-color:       $borderColorMain;
}

$borderColorAlt:      mix(palette('bgAlt'), palette('fgAlt'), 80%);
@mixin altColors {
  background-color:   palette('bgAlt');
  color:              palette('fgAlt');
  border-color:       $borderColorAlt;
}

// Body
//============================================================
$bodyBackground: false!default;
$bodyBgColor:    palette('bgMain')!default;

// Posts
//============================================================
$replyBgColor: palette('bgAlt')!default;
$replyColor: palette('fgAlt')!default;

// Header
$nameColor:           take($linkColor, palette('accentA'),
                    $saturation: 100, $hue: 100)!default;
// false -> normal, true -> bold or a numerical value (400 = normal, 700 = bold)
$nameBold:            550!default;
$nameEmailColor:      $linkColor!default;
$roleColor:           take-lightness(palette('warning'), $linkColor)!default;
$subjectColor:        take($linkColor, palette('accentB'),
                    $saturation: 100, $hue: 100)!default;
$subjectBold:         550!default;

$linkReplyColor:      $linkColor!default;
// Message
//Can either be a color to take the hue from, or 'false' to disable markedPost styling
$markedPost: palette('accentB')!default; 
$markedPostBgColor:   if($markedPost, take-hue($replyBgColor, $markedPost, 90%), false)!default;

$greenTextColor:      take-lightness(#0f0, palette('fgMain'), 50%)!default;
$redTextColor:        take-lightness(#f00, palette('fgMain'), 50%)!default;
$redTextFontSize:     1.05em;
$redTextBold:         bold;
$quoteLinkColor:      $linkColor!default;

$spoilerColor: soften-lightness(
  change-color(#000, $lightness: lightness(palette('fgMain'))),
  $replyBgColor)!default;
$spoilerColorHover: intense-lightness($spoilerColor)!default;

// =Buttons
//=============================================================
$buttonBgOpacity:     0.5;

$submitBgColor:       mix(palette('fgAlt'), palette('bgAlt'), 50%);
$submitFgColor:       palette('bgMain');

$buttonBgColor:       mix(palette('bgAlt'), $submitBgColor, 70%);
$buttonFgColor:       palette('fgAlt');

@mixin buttonColors {
  background-color:   $buttonBgColor;
  color:              $buttonFgColor;
  border-color:       mix($buttonBgColor, palette('fgMain'));
}

@mixin submitColors {
  background-color:   $submitBgColor;
  color:              $submitFgColor;
  border-color:       mix($buttonBgColor, palette('fgMain'));
}

// =Post form
//=============================================================
$postFormBgColor:     palette('bgAlt')!default;
$postFormBorderColor: $borderColorAlt!default;
$postFormColor:       palette('fgAlt')!default;

// =Header
//=============================================================
@mixin headerColors {
  background-color:   palette('bgAlt');
  color:              palette('fgAlt');
  border-color:       $borderColorAlt;
}
